<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" type="text/css" href="mystyle.css">
  <title>Data Catalog</title>
</head>

<body>

  <h1 id="Agency"></h1>

  <ul id="menu">
  <li><a href="">Administrative</a></li>
  <li><a href="">Demographic</a></li>
  <li><a href="">Transportation</a></li>
  </ul>

  <div id='catalog'></div>


<script>
var xmlhttp = new XMLHttpRequest();
var xmlhttp1 = new XMLHttpRequest();

var catalogLinkUrl = "https://raw.githubusercontent.com/kansasgis/CatalogAPI/master/CatalogLinks.json";
var state = "Kansas";

xmlhttp1.open("GET", catalogLinkUrl, true);
xmlhttp1.onreadystatechange = function() {
		var myArr1 = JSON.parse(xmlhttp1.responseText);
		var stateUrl = myArr1.catalogLinks[state];
		xmlhttp.open("GET", stateUrl, true);
		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
				var myArr = JSON.parse(xmlhttp.responseText);
				createTitle(myArr);
				populateEntries(myArr);
			}
		};
xmlhttp.send();
};
xmlhttp1.send();

function createTitle(arr) {
var out = arr.catalog.title;
document.getElementById("Agency").innerHTML = out;
}

function populateEntries(arr) {
var bigOut = "";
var i;
for(i = 0; i < arr.catalog.catalogEntries.length; i++){
if (arr.catalog.catalogEntries[i].Thumbnail.length > 0) {
bigOut += '<img src="' + arr.catalog.catalogEntries[i].Thumbnail + '" />';
};

bigOut += '<p><span id="title">' + arr.catalog.catalogEntries[i].Title +
'</span> (WKID: ' + arr.catalog.catalogEntries[i].Projection + ')<br> <a href="' + arr.catalog.catalogEntries[i].WebLink + '">Permalink</a><br><br>' +
arr.catalog.catalogEntries[i].Description + '<br><br> Data Creator: ' + arr.catalog.catalogEntries[i].DataCreator + '<br>';

if (arr.catalog.catalogEntries[i].MetadataLink != "") {
	bigOut += '<a href="' + arr.catalog.catalogEntries[i].MetadataLink + '">Full Metadata</a><br>'}

if (arr.catalog.catalogEntries[i].DownloadLink.length > 0) {
bigOut += '<br><span id="download">Data Downloads</span>: <br>';
var ddi;
for(ddi = 0; ddi < arr.catalog.catalogEntries[i].DownloadLink.length; ddi++){
bigOut += '<a href="' + arr.catalog.catalogEntries[i].DownloadLink[ddi].url + '">'
+ arr.catalog.catalogEntries[i].DownloadLink[ddi].DataTitle + ': ' + arr.catalog.catalogEntries[i].DownloadLink[ddi].DataType + '</a><br>' }
bigOut += '<br>'}

if (arr.catalog.catalogEntries[i].ServiceLink.length > 0) {
bigOut += 'Web Services: <br>';
var s;
for(s = 0; s < arr.catalog.catalogEntries[i].ServiceLink.length; s++){
bigOut += '<a target="_blank" href="' + arr.catalog.catalogEntries[i].ServiceLink[s] + '">Rest Url</a>: <a target="_blank" href="http://www.arcgis.com/home/webmap/viewer.html?url='+ arr.catalog.catalogEntries[i].ServiceLink[s] + '">View in ArcGIS.com</a><br>';}
bigOut += '<br>'}

if (arr.catalog.catalogEntries[i].Documentation.length > 0) {
bigOut += 'Documentation: <br>';
var d;
for(d = 0; d < arr.catalog.catalogEntries[i].Documentation.length; d++){
bigOut += '<a href="' + arr.catalog.catalogEntries[i].Documentation[d] + '">' + arr.catalog.catalogEntries[i].Documentation[d] + '</a><br>';}
bigOut += '<br>'}

bigOut += '</p>';
}
document.getElementById("catalog").innerHTML = bigOut;
}

function showStuff(kind) {
	document.getElementById(kind).color = orange;
};
</script>
</body>
</html>